{
    "name": "ANUGA Busselton example",
    "description": "This template contains a pre-canned event (a wave) entering on the WEST of the grid, heading east, designed for coastal simulations of the Busselton-Bunbury area.\n\nThe implemented solver (Parallel finite volume method for hydrodynamic inundation modelling) is [described here](http://journal.austms.org.au/ojs/index.php/ANZIAMJ/article/view/153/)\n\nAn overview of the solver is [available here](http://www.ga.gov.au/corporate_data/69370/Rec2009_036.pdf).\n\nInputs:\n\nThe template can be customised in a variety of ways \n\n\tXxxx\n\n\tYyyy\n\n\tZzzz\n\nAnd is paired with a DEM of the area in question.\n\n\n\nOutputs:\n\n\tScreenshots of xxx\n\n\tCustom ANUGA SSW (database) of the simulation",
    "homepage": "https://github.com/GeoscienceAustralia/tcrm",
    "template": "\"\"\"Script for running a tsunami inundation scenario for Busselton, WA Australia.\n\nSource data such as elevation and boundary data is assumed to be available in\ndirectories specified by project.py\nThe output sww file is stored in directory named after the scenario, i.e\nslide or fixed_wave.\n\nThe scenario is defined by a triangular mesh created from project.polygon,\nthe elevation data and a tsunami wave generated by a submarine mass failure.\n\nGeoscience Australia, 2004-present\n\"\"\"\n\n\"\"\"ANUGA modelling using portal netCDF data\"\"\"\n\n\n#------------------------------------------------------------------------------\n# Import necessary modules\n#------------------------------------------------------------------------------\n# Standard modules\nimport os\nimport time\nimport sys\nfrom math import sin, pi, exp\nimport numpy as np\nimport VHIRL_conversions\nimport subprocess\nfrom os.path import join, exists\n\n# Related major packages\nimport anuga\n\n######################################################\n####### Do not change anything above this line #######\n\n# Definition of file names and polygons\n\"\"\" Common filenames and locations for topographic data, meshes and outputs.\n    This file defines the parameters of the scenario you wish to run.\n\"\"\"\n\n#------------------------------------------------------------------------------\n# Filenames\n#------------------------------------------------------------------------------\n\n# Filename for input data (NetCDF format)\ndataset = '${input_dataset}'\nname_stem = scenario_name = '${name_stem}'\nmeshname = name_stem + '.msh'\n\n#------------------------------------------------------------------------------\n# Runtime parameters\n#------------------------------------------------------------------------------\nv_cache = False\nv_verbose = True\n\n#------------------------------------------------------------------------------\n# Define scenario as either slide or fixed_wave. Choose one.\n#------------------------------------------------------------------------------\nscenario = 'fixed_wave' # Huge wave applied at the boundary\n\n\n#------------------------------------------------------------------------------\n# Domain definitions\n#------------------------------------------------------------------------------\n# bounding polygon for study area\nbusselton_extent = np.asarray([[357325,6270510],\n                               [344635,6267810],\n                               [314645,6268400],\n                               [286811,6277911],\n                               [286174,6308019],\n                               [293089,6341152],\n                               [344595,6456235],\n                               [389463,6441867],\n                               [392955,6320400],\n                               [379095,6288910]])\n\nzone = 50\nbase_scale = ${base_scale}\ndefault_res = 25 * base_scale   # Background resolution\n\n#------------------------------------------------------------------------------\n# Data for Tides\n#------------------------------------------------------------------------------\nv_tide = ${tide}\n\n\n####### Do not change anything below this line #######\n######################################################\n\njobstart = time.time()\n\n\n# Create ASC from nc data\nVHIRL_conversions.nc2asc(dataset, name_stem, zone=zone)\n\n# Create DEM from asc data\nanuga.asc2dem(name_stem+'.asc', use_cache=v_cache, verbose=v_verbose)\n\n# Create pts file for onshore DEM\nanuga.dem2pts(name_stem+'.dem', use_cache=v_cache, verbose=v_verbose)\n\n#------------------------------------------------------------------------------\n# Create the triangular mesh and domain based on\n# overall clipping polygon with a tagged\n# boundary and interior regions as defined in project.py\n#------------------------------------------------------------------------------\ndomain = anuga.create_domain_from_regions(busselton_extent,\n                                    boundary_tags={'land_sse': [0],\n                                                   'land_s': [1],\n                                                   'bottom': [2],\n                                                   'ocean_wsw': [3],\n                                                   'ocean_w': [4],\n                                                   'ocean_wnw': [5],\n                                                   'top': [6],\n                                                   'land_nne': [7],\n                                                   'land_ese': [8],\n                                                   'land_se': [9]},\n                                    maximum_triangle_area=default_res,\n                                    mesh_filename=meshname,\n                                    use_cache=v_cache,\n                                    verbose=v_verbose)\n\n# Print some stats about mesh and domain\nprint 'Number of triangles = ', len(domain)\nprint 'The extent is ', domain.get_extent()\nprint domain.statistics()\n\n#------------------------------------------------------------------------------\n# Setup parameters of computational domain\n#------------------------------------------------------------------------------\ndomain.set_name('busselton_' + scenario)       # Name of sww file\ndomain.set_datadir('.')                       # Store sww output here\ndomain.set_minimum_storable_height(0.01)      # Store only depth > 1cm\ndomain.set_flow_algorithm('tsunami')\n\n\n\n#------------------------------------------------------------------------------\n# Setup initial conditions\n#------------------------------------------------------------------------------\ntide = v_tide\ndomain.set_quantity('stage', tide)\ndomain.set_quantity('friction', 0.0)\n\n\ndomain.set_quantity('elevation',\n                    filename=name_stem + '.pts',\n                    use_cache=v_cache,\n                    verbose=v_verbose,\n                    alpha=0.1)\n\n\nbounaryStartTime = time.time()\n\n#------------------------------------------------------------------------------\n# Setup boundary conditions\n#------------------------------------------------------------------------------\nprint 'Available boundary tags', domain.get_boundary_tags()\n\n# Mean water level\nBd = anuga.Dirichlet_boundary([tide, 0, 0]) \n\n# Neutral boundary\nBs = anuga.Transmissive_stage_zero_momentum_boundary(domain)\n\n# Define tsunami wave (in metres and seconds).\nthe_wave = lambda t: [(20*np.sin(t*np.pi/(60*10)))*np.exp(-t/600), 0, 0]\nBw = anuga.Time_boundary(domain=domain, function=the_wave)\n\ndomain.set_boundary({'land_sse': Bs,\n                     'land_s': Bs,\n                     'bottom': Bs,\n                     'ocean_wsw': Bw,\n                     'ocean_w': Bw,\n                     'ocean_wnw': Bw,\n                     'top': Bs,\n                     'land_nne': Bs,\n                     'land_ese': Bs,\n                     'land_se': Bs})\n\n\n#------------------------------------------------------------------------------\n# Evolve system through time\n#------------------------------------------------------------------------------\n\nevolveStartTime = time.time()\n\n\n# Save every two mins leading up to wave approaching land\nfor t in domain.evolve(yieldstep=2*60,\n                       finaltime=5000):\n    print domain.timestepping_statistics()\n    print domain.boundary_statistics(tags='ocean_wnw')\n\n# Save every 30 secs as wave starts inundating ashore\nfor t in domain.evolve(yieldstep=60*0.5,\n                       finaltime=7000,\n                       skip_initial_step=True):\n    print domain.timestepping_statistics()\n    print domain.boundary_statistics(tags='ocean_wnw')\n\n\n\n\n#------------------------------------------------------------------------------\n# Upload Result Files to Cloud Storage\n#------------------------------------------------------------------------------\ndef cloudUpload(inFilePath, cloudKey):\n    cloudBucket = os.environ[\"STORAGE_BUCKET\"]\n    cloudDir = os.environ[\"STORAGE_BASE_KEY_PATH\"]\n    queryPath = (cloudBucket + \"/\" + cloudDir + \"/\" + cloudKey).replace(\"//\", \"/\")\n    retcode = subprocess.call([\"cloud\", \"upload\", cloudKey, inFilePath, \"--set-acl=public-read\"])\n    print (\"cloudUpload: \" + inFilePath + \" to \" + queryPath + \" returned \" + str(retcode))\n\n\nuploadStartTime = time.time()\n\n# Upload results\nprint 'Uploading result files'\ncloudUpload(\"${input_dataset}\", \"raw_elevation\")\ncloudUpload(\"${name_stem}_UTM.nc\", \"${name_stem}_UTM.nc\")\ncloudUpload(\"${name_stem}.asc\", \"${name_stem}.asc\")\ncloudUpload(\"${name_stem}.prj\", \"${name_stem}.prj\")\ncloudUpload(\"${name_stem}.dem\", \"${name_stem}.dem\")\ncloudUpload(\"${name_stem}.pts\", \"${name_stem}.pts\")\ncloudUpload(\"${name_stem}.msh\", \"${name_stem}.msh\")\ncloudUpload(\"${name_stem}_fixed_wave.sww\", \"${name_stem}_fixed_wave.sww\")\n\nprint 'If you wish to view your output - please look at anuga-viewer here: http://sourceforge.net/projects/anuga/files/'\n\nprint '''\n---------------\n| Timer Stats |\n---------------\n'''\nprint 'Convert/Fit   : %.2f seconds' %(bounaryStartTime-jobstart)\nprint 'Bounding      : %.2f seconds' %(evolveStartTime-bounaryStartTime)\nprint 'Evolve        : %.2f seconds' %(uploadStartTime-evolveStartTime)\nprint 'Upload        : %.2f seconds' %(time.time()-uploadStartTime)\nprint 'Total time: %.2f seconds' %(time.time()-jobstart)\n",
    "variables": [
        {
            "type": "int",
            "name": "base_scale",
            "label": "Base Scale",
            "default": 400000,
            "optional": false,
            "min": 1
        },
        {
            "type": "double",
            "name": "tide",
            "label": "Tide",
            "default": 0.0,
            "min": 0.0,
            "step": 0.1,
            "optional": false
        },
        {
            "type": "string",
            "name": "name_stem",
            "label": "File Name",
            "default": "busselton",
            "optional": false
        }
    ]
}
